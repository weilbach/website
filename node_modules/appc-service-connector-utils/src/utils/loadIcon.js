const path = require('path')
const fs = require('fs')
const defaultIconFileName = 'icon.svg'
const defaultIconClass = 'icon-GG-link'
module.exports = (connectorPath) => {
  if (!connectorPath) { return defaultIconClass }

  const file = path.join(connectorPath, defaultIconFileName)

  if (!fs.existsSync(file)) { return defaultIconClass }

  const match = file.match(/\.(?:bmp|jpeg|jpg|png|gif|tiff|svg)$/)
  if (!match) { return defaultIconClass }

  let type = match[0].substr(1)
  if (type === 'svg') {
    type = 'svg+xml'
  } else if (type === 'jpg') {
    type = 'jpeg'
  }
  try {
    const data = fs.readFileSync(file).toString('base64')
    return `data:image/${type};base64,${data}`
  } catch (e) {
    return defaultIconClass
  }
}
