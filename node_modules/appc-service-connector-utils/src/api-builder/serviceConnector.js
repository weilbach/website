const { FlowNode } = require('axway-flow')
const wrapSDKFunction = require('./sdkFunctionWrapper')

/**
 * Factory that return ServiceConnector class.
 * Instance of ServiceConnector should contain Service Connetor sdk functions configured in the context of API Builder.
 * Such SDK is ready to serve Flow Nodes within API Builder
 *
 * @param {Object} config connector configuration provided from the API Builder application
 * @param {Object} sdk sdk created based on the swagger definition
 */
module.exports = (config, sdk) => {
  return class ServiceConnector extends FlowNode {
    constructor (name, node, spec, flow) {
      super(name, node, spec, flow)
      Object.keys(sdk).forEach((fn) => {
        const func = sdk[fn]
        this[fn] = wrapSDKFunction(config, func)
      })
    }
  }
}
