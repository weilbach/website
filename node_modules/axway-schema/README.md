# axway-schema

A singleton module for loading custom schemas and resolving them to json-schema docs

# API Reference

**Example** *(Quick start)*  
```javascript
 const schemas = require('axway-schema');
 schemas.add('./schemas/foo.json')
	  .add('./schemas/bar.json', 'schema://myproject/bar')
	  .add('./schemas/swagger-v2.0.json')
	  .loadSync();
 schemas.get('schema:///foo');
 schemas.validate('schema:///foo', foo);
 schemas.get('schema:///foo/myproject/bar');
 schemas.validate('schema:///foo/myproject/bar', bar);
 schemas.get('http://swagger.io/v2/schema.json#');
 schemas.validate('http://swagger.io/v2/schema.json#', swagger);
 schemas.dereference(swagger);
 schemas.dereference(swagger, { target: '#/definitions' });
 schemas.dereference(swagger, { target: '#/definitions', rename: (id) => { return 'foo'; } });
```
<a name="module_axway-schema..AxwaySchema"></a>

### axway-schema~AxwaySchema
A schema manager.

**Kind**: inner class of [<code>axway-schema</code>](#module_axway-schema)  
**Access**: public  

* [~AxwaySchema](#module_axway-schema..AxwaySchema)
    * [new AxwaySchema()](#new_module_axway-schema..AxwaySchema_new)
    * [.setLogger(logger)](#module_axway-schema..AxwaySchema+setLogger)
    * [.add(item, [defaultId])](#module_axway-schema..AxwaySchema+add) ⇒ <code>AxwaySchema</code>
    * [.register(schema)](#module_axway-schema..AxwaySchema+register) ⇒ <code>AxwaySchema</code>
    * [.loadSync()](#module_axway-schema..AxwaySchema+loadSync) ⇒ <code>AxwaySchema</code>
    * [.clear()](#module_axway-schema..AxwaySchema+clear) ⇒ <code>AxwaySchema</code>
    * [.exists(id)](#module_axway-schema..AxwaySchema+exists) ⇒ <code>boolean</code>
    * [.get([id])](#module_axway-schema..AxwaySchema+get) ⇒ <code>object</code>
    * [.validate(id, obj)](#module_axway-schema..AxwaySchema+validate) ⇒ <code>string</code>
    * [.dereference(doc, [options])](#module_axway-schema..AxwaySchema+dereference) ⇒ <code>object</code>
    * [.getErrorString(errors, objectType)](#module_axway-schema..AxwaySchema+getErrorString) ⇒ <code>string</code>

<a name="new_module_axway-schema..AxwaySchema_new"></a>

#### new AxwaySchema()
Constructs a schema manager.  The instance is a singleton.

<a name="module_axway-schema..AxwaySchema+setLogger"></a>

#### axwaySchema.setLogger(logger)
Sets the Logger

**Kind**: instance method of [<code>AxwaySchema</code>](#module_axway-schema..AxwaySchema)  
**Access**: public  

| Param | Type | Description |
| --- | --- | --- |
| logger | <code>Logger</code> | A logger. |

<a name="module_axway-schema..AxwaySchema+add"></a>

#### axwaySchema.add(item, [defaultId]) ⇒ <code>AxwaySchema</code>
Adds an item to be loaded later by calling
[loadSync](#module_axway-schema..AxwaySchema+loadSync).
The `item` can be a `string`, in which case it is a schema file, and an optional `defaultId`
will be used for the `id` if the file does not have an `id`.  If the file does not have an
`id` and no `defaultId` is supplied, the function will throw.

If the `item` is an object, it is a valid schema that has an `id` defined so that
it can be referenced later.  In this case, `defaultId` is ignored.

**Kind**: instance method of [<code>AxwaySchema</code>](#module_axway-schema..AxwaySchema)  
**Returns**: <code>AxwaySchema</code> - The [AxwaySchema](AxwaySchema) object.  
**Access**: public  

| Param | Type | Description |
| --- | --- | --- |
| item | <code>string</code> \| <code>object</code> | The item to add (a filename or schema). |
| [defaultId] | <code>string</code> | The item id if one not supplied. |

**Example** *(Add a schema)*  
```javascript
 const schemas = new AxwaySchema();
 schemas.add('./schema1.json');
 schemas.add('./schema2.json', 'schema://project/myapp/schema2.json');
 schemas.add({id: 'http://axway.com/schemas/user.json'});
```
<a name="module_axway-schema..AxwaySchema+register"></a>

#### axwaySchema.register(schema) ⇒ <code>AxwaySchema</code>
Registers a global schema that will persist across calls to
[clear](#module_axway-schema..AxwaySchema+clear) operations.  Schemas registered with
the same `id` will generate a warning but will be ignored.

**Kind**: instance method of [<code>AxwaySchema</code>](#module_axway-schema..AxwaySchema)  
**Returns**: <code>AxwaySchema</code> - The [AxwaySchema](AxwaySchema) object.  

| Param | Type | Description |
| --- | --- | --- |
| schema | <code>object</code> | The schema. |

<a name="module_axway-schema..AxwaySchema+loadSync"></a>

#### axwaySchema.loadSync() ⇒ <code>AxwaySchema</code>
Loads all schemas previously added with calls to
[add](#module_axway-schema..AxwaySchema+add).

**Kind**: instance method of [<code>AxwaySchema</code>](#module_axway-schema..AxwaySchema)  
**Returns**: <code>AxwaySchema</code> - The [AxwaySchema](AxwaySchema) object.  
**Access**: public  
**Example** *(Load schemas)*  
```javascript
 const schemas = new AxwaySchema();
 schemas
	  .add('./schema1.json');
	  .add('./schema2.json', 'project');
	  .loadSync());
```
<a name="module_axway-schema..AxwaySchema+clear"></a>

#### axwaySchema.clear() ⇒ <code>AxwaySchema</code>
Clears all schemas and resets state.  All registered schema will be automatically re-added
on next load.

**Kind**: instance method of [<code>AxwaySchema</code>](#module_axway-schema..AxwaySchema)  
**Returns**: <code>AxwaySchema</code> - The [AxwaySchema](AxwaySchema) object.  
**Access**: public  
<a name="module_axway-schema..AxwaySchema+exists"></a>

#### axwaySchema.exists(id) ⇒ <code>boolean</code>
Tests whether or not a schema is loaded, identified by `id`.

**Kind**: instance method of [<code>AxwaySchema</code>](#module_axway-schema..AxwaySchema)  
**Returns**: <code>boolean</code> - True if the schema exists.  
**Access**: public  

| Param | Type | Description |
| --- | --- | --- |
| id | <code>string</code> | The schema identifier to test. |

<a name="module_axway-schema..AxwaySchema+get"></a>

#### axwaySchema.get([id]) ⇒ <code>object</code>
Gets a schema by `id`.  If `id` is not supplied, all schemas are returned.

**Kind**: instance method of [<code>AxwaySchema</code>](#module_axway-schema..AxwaySchema)  
**Returns**: <code>object</code> - Returns a schema identified by `id`.  
**Access**: public  

| Param | Type | Description |
| --- | --- | --- |
| [id] | <code>string</code> | The schema identifier. |

<a name="module_axway-schema..AxwaySchema+validate"></a>

#### axwaySchema.validate(id, obj) ⇒ <code>string</code>
Validates an object `obj` against a schema identified by `id`.

**Kind**: instance method of [<code>AxwaySchema</code>](#module_axway-schema..AxwaySchema)  
**Returns**: <code>string</code> - Returns an error string when not valid, undefined otherwise.  
**Access**: public  

| Param | Type | Description |
| --- | --- | --- |
| id | <code>string</code> | The schema identifier. |
| obj | <code>object</code> | The object to validate. |

<a name="module_axway-schema..AxwaySchema+dereference"></a>

#### axwaySchema.dereference(doc, [options]) ⇒ <code>object</code>
Dereferences non-local references in the supplied document.  The supplied
document is not modified.  All non-local references (e.g `schema://`) will
be replaced with the corresponding loaded schema.  If schema are not found,
an error will be thrown.

If `options.target` is not supplied, then references are expanded inline.  If
`options.target` is supplied, then references are expanded in the location specified
by `options.target` and any existing reference updated to point to the new target.
For example, if the `options.target` is `#/definitions`, then the schema will be
expanded to `$.definitions` with the name of the schema the trailing component
(basename) of its `id`, or if `options.rename` is supplied, the name
returned by that.

**Kind**: instance method of [<code>AxwaySchema</code>](#module_axway-schema..AxwaySchema)  
**Returns**: <code>object</code> - Returns a document with `schema://` references expanded.  
**Access**: public  

| Param | Type | Description |
| --- | --- | --- |
| doc | <code>object</code> | A document |
| [options] | <code>object</code> | Options |
| [options.target] | <code>string</code> | A target |
| [options.rename] | <code>targetRenameCallback</code> | A callback to rename schema |

<a name="module_axway-schema..AxwaySchema+getErrorString"></a>

#### axwaySchema.getErrorString(errors, objectType) ⇒ <code>string</code>
The ajv.errorsText is actually not very good.

**Kind**: instance method of [<code>AxwaySchema</code>](#module_axway-schema..AxwaySchema)  
**Returns**: <code>string</code> - A formatted error string.  
**Access**: public  

| Param | Type | Description |
| --- | --- | --- |
| errors | <code>array</code> | ajv errors object |
| objectType | <code>string</code> | The name of the object type that was validated |

<a name="module_axway-schema..targetRenameCallback"></a>

### axway-schema~targetRenameCallback ⇒ <code>string</code>
Callback function to rename a target when used as a
[dereference](#module_axway-schema..AxwaySchema+dereference) target.
For example, if your id is "schema://svc.foo/bar", then `bar` will be written
to the dereference target as `bar`.  If you want to rename `bar`, then use
this function.

**Kind**: inner typedef of [<code>axway-schema</code>](#module_axway-schema)  
**Returns**: <code>string</code> - Return the renamed target.  
**Access**: public  

| Param | Type | Description |
| --- | --- | --- |
| id | <code>id</code> | The schema id. |


## Building

```bash
npm run build
```

## Author

Axway <support@axway.com> https://axway.com

## License

This code is closed source and Confidential and Proprietary to Axway, Inc. All Rights Reserved. This code MUST not be modified, copied or otherwise redistributed without express written permission of Axway. This file is licensed as part of the Axway Platform and governed under the terms of the Axway license agreement. Your right to use this software terminates when you terminate your Axway subscription.
